---
sidebar_position: 1
sidebar_label: Using Prebuilt Classes
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ForgeIcon from '@site/static/img/forge-icon.webp';
import FabricIcon from '@site/static/img/fabric-icon.webp';
import NeoForgeIcon from '@site/static/img/neoforge-icon.webp';

# Using Prebuilt Classes

MrCrayfish's Furniture Mod: Refurbished provides many prebuilt classes that you can extend to avoid common boilerplate code. You'll need to decide whether you are going to create a **Module** or a **Source**. A **Module** is an electricity block that recieves electrical power (like the Computer), while a **Source** is an electricity block (like the Electricity Generator) that produces and provides electrical power to **modules**. 

For a block entity to become an electricity block, they implement one of the following interfaces: `IModuleNode` for **Modules**, and `ISourceNode` for **Sources**. Since this guide is about using one of the prebuilt classes, you will not need to worry about implementing these interfaces. You can however read the [Custom Implementation](/docs/addons/electricity_system/new_block/custom_implementation.mdx) guide to learn more about how the electricity system is implemented from scratch.

## List of Available Classes

Create a new block and make it extend one of the classes below. All classes are available under the package: `com.mrcrayfish.furniture.refurbished.blockentity`

#### Officially Supported
- <span class="badge badge--success">Module</span> `ElectricityModuleBlockEntity` - Base class of `BlockEntity` with `IModuleNode` implementation.
- <span class="badge badge--success">Module</span> `ElectricityModuleContainerBlockEntity` - Vanilla's container block entity with `IModuleNode` implementation.
- <span class="badge badge--warning">Source</span> `ElectricitySourceBlockEntity` - Base class of `BlockEntity` with `ISourceNode` implementation.
- <span class="badge badge--warning">Source</span> `ElectricitySourceContainerBlockEntity` - Vanilla's container block entity with `ISourceNode` implementation.

#### Extras

You may additonally use some custom classes created for the mod. They are used frequently in the mod for setting up new containers and processing blocks. **There are no gaurantees these will be suitable for your use case, they are custom designed for the mod. Use at your own discretion!**

- <span class="badge badge--success">Module</span> `ElectricityModuleLootBlockEntity` - A class extending `BasicLootBlockEntity`, a custom class used in the mod to help set up new container blocks. It uses a `IModuleNode` implementation. You can see an example of it being used for the [Workbench](https://github.com/MrCrayfish/MrCrayfishFurnitureMod-Refurbished/blob/1.20.4/common/src/main/java/com/mrcrayfish/furniture/refurbished/blockentity/WorkbenchBlockEntity.java).
- <span class="badge badge--success">Module</span> `ElectricityModuleProcessingLootBlockEntity` - A class extending `ProcessingContainerBlockEntity`, a custom class used in the mod to help set up new processing blocks with containers. It uses a `IModuleNode` implementation. You can see an example of it being used for the [Freezer](https://github.com/MrCrayfish/MrCrayfishFurnitureMod-Refurbished/blob/1.20.4/common/src/main/java/com/mrcrayfish/furniture/refurbished/blockentity/FreezerBlockEntity.java).
- <span class="badge badge--warning">Source</span> `ElectricitySourceLootBlockEntity` - A class extending `BasicLootBlockEntity`, a custom class used in the mod to help set up new container blocks. It uses a `ISourceNode` implementation. You can see an example of it being used for the [Electricity Generator](https://github.com/MrCrayfish/MrCrayfishFurnitureMod-Refurbished/blob/1.20.4/common/src/main/java/com/mrcrayfish/furniture/refurbished/blockentity/ElectricityGeneratorBlockEntity.java).

## Implementing the Methods

Every electricity block, **modules** and **sources**, have a `powered` state. Upon extending one of the classes, there are two core methods you'll need to implement: `isNodePowered()` and `setNodePowered(boolean)`. These methods control the `powered` state and must be implemented correctly for your block to work. It is **important** that the implementation of `isNodePowered()` returns the correct state on both client and server side. The `powered` state must also be saved to disk. This guide will cover two options for implementing these methods.

:::note
Depending on the class you extend, there may be more methods you need to write an implementation for. This guide will not cover vanilla methods or methods from classes in the **Extras** section.
:::

<div className="code-block">
#### Block State Property <span class="badge badge--success">Easy</span>
This is the best option when it comes to implementing the `powered` state as you do not need to worry about saving and syncing the value, the game already handles this for you. It is also great as allows you to change the model of your block; you can show a different block model when it is powered. Below is all the code you need in your block entity.
<Tabs className="unique-tabs">
    <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
        ```java title="ExampleBlockEntity.java"
        @Override
        public boolean isNodePowered() {
            BlockState state = this.getBlockState();
            return state.hasProperty(BlockStateProperties.POWERED) && state.getValue(BlockStateProperties.POWERED);
        }

        @Override
        public void setNodePowered(boolean powered) {
            BlockState state = this.getBlockState();
            if(state.hasProperty(BlockStateProperties.POWERED)) {
                this.level.setBlock(this.worldPosition, state.setValue(BlockStateProperties.POWERED, powered), Block.UPDATE_ALL);
            }
        }
        ```
    </TabItem>
    <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>} default>
        ```java title="ExampleBlockEntity.java"
        @Override
        public boolean isNodePowered() {
            BlockState state = this.getBlockState();
            return state.hasProperty(BlockStateProperties.POWERED) && state.getValue(BlockStateProperties.POWERED);
        }

        @Override
        public void setNodePowered(boolean powered) {
            BlockState state = this.getBlockState();
            if(state.hasProperty(BlockStateProperties.POWERED)) {
                this.level.setBlock(this.worldPosition, state.setValue(BlockStateProperties.POWERED, powered), Block.UPDATE_ALL);
            }
        }
        ```
    </TabItem>
</Tabs>
</div>

<div className="code-block">
#### Block Entity Variable <span class="badge badge--danger">Advanced</span>

If you've gone with a simple `boolean` variable in your block entity class to represent the `powered` state, you will need to handle loading/saving and syncing. This is however quite simple, you just need to append the following to your `load(CompoundTag)` and `saveAdditional(CompoundTag)` methods of your block entity.

:::note
The following example is an implementation that will sync everything in `saveAdditional(CompoundTag)` to clients. This may not be ideal since you should only send what is needed for the client. You can customise what is sent to the client by overriding the method `getUpdateTag()`. Make sure `powered` state and the nodes `connections` are still sent if you override this method.
:::
<Tabs className="unique-tabs">
    <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
        ```java title="ExampleBlockEntity.java"
        // Your variable, may be named different
        protected boolean powered;

        @Override
        public boolean isNodePowered() {
            return this.powered;
        }

        @Override
        public void setNodePowered(boolean powered) {
            this.powered = powered;
            // From BlockEntity. Must call or block entity won't save.
            this.setChanged();
            // From IElectricityNode. Helper method to sync block entity data
            // You must update clients immediately of change.
            this.syncDataToTrackingClients(); 
        }

        @Override
        public void load(CompoundTag tag) {
            // ...
            this.powered = tag.getBoolean("Powered");
        }

        @Override
        public void saveAdditional(CompoundTag tag) {
            // ...
            tag.putBoolean("Powered", this.powered);
        }
        ```
    </TabItem>
    <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>} default>
        ```java title="ExampleBlockEntity.java"
        // Your variable, may be named different
        protected boolean powered;

        @Override
        public boolean isNodePowered() {
            return this.powered;
        }

        @Override
        public void setNodePowered(boolean powered) {
            this.powered = powered;
            // From BlockEntity. Must call or block entity won't save.
            this.setChanged();
            // From IElectricityNode. Helper method to sync block entity data
            // You must update clients immediately of change.
            this.syncDataToTrackingClients(); 
        }

        @Override
        public void load(CompoundTag tag) {
            // ...
            this.powered = tag.getBoolean("Powered");
        }

        @Override
        public void saveAdditional(CompoundTag tag) {
            // ...
            tag.putBoolean("Powered", this.powered);
        }
        ```
    </TabItem>
</Tabs>
</div>

## Handling Node Destruction

Electricity nodes need to be notified when a player mines the block. This will ensure the `connections` to other nodes are removed. This is simply handled inside your block class with the following code:

```java title="ExampleBlock.java"
@Override
public void onRemove(BlockState state, Level level, BlockPos pos, BlockState newState, boolean isMoving) {
    if(!state.is(newState.getBlock())) {
        BlockEntity blockEntity = level.getBlockEntity(pos);
        if(blockEntity instanceof IElectricityNode node) {
            node.onNodeDestroyed();
        }
    }
    super.onRemove(state, level, pos, newState, isMoving);
}
```

## Ticking the Electricty Node

:::info
This section can be skipped if you aren't creating a **Module**. **Sources** are automatically registered into a custom tick system in an overridden `setLevel(Level)` method of your block entity. Reading the first paragraph will however give you an insight into how the electricity system works.
:::

**Modules** recieve electrical power, while **sources** provide electrical power. **Modules** self manage their `powered` state on every game tick, which is based on if they recieved electrical power from a **source**. A **source** (like the Electricity Generator) mark **modules** (like the Ceiling Light) in the network as receiving power but don't actually update their `powered` state. Upon a **module** recieving a game tick, if it is marked as received electrical power and it is not powered, it will update it's `powered` state to `true`. If it is not marked as received electrical power and it is powered, it will update it's `powered` state to `false`. Immediately after, `setNodeReceivingPower(boolean)` will be called on itself with `false` to indicate the "marked state" as consumed. Now that you know the basics of how game ticks are applied to **modules** and **sources**, it's time to register the ticker.

### Registering Modules

**Modules** are simply registered as any normal block entity using a `BlockEntityTicker`. Your block class should extend vanilla's `BaseEntityBlock` otherwise you will have to write your own helper method to create the `BlockEntityTicker`. The `serverTick` method is already implemented from the class you extended in the previous steps.

<Tabs className="unique-tabs">
    <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
        ```java title="ExampleBlock.java"
        @Nullable
        @Override
        public <T extends BlockEntity> BlockEntityTicker<T> getTicker(Level level, BlockState state, BlockEntityType<T> type) {
            // Only register on logical server side
            if(!level.isClientSide()) {
                // From BaseEntityBlock#createTickerHelper
                return createTickerHelper(type, <ExampleBlockEntityTypeInstance>, ExampleBlockEntity::serverTick);
            }
            return null;
        }
        ```
    </TabItem>
    <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>} default>
        ```java title="ExampleBlock.java"
        @Nullable
        @Override
        public <T extends BlockEntity> BlockEntityTicker<T> getTicker(Level level, BlockState state, BlockEntityType<T> type) {
            // Only register on logical server side
            if(!level.isClientSide()) {
                // From BaseEntityBlock#createTickerHelper
                return createTickerHelper(type, <ExampleBlockEntityTypeInstance>, ExampleBlockEntity::serverTick);
            }
            return null;
        }
        ```
    </TabItem>
</Tabs>

## Register the Block Entity Renderer

In order to render the node and its connections, you'll need to register a block entity renderer for your block entity. This is also crucial for enabling interaction with the Wrench.

MrCrayfish's Furniture Mod: Refurbished comes with a default block entity renderer for electricity blocks. Simply bind your block entity type with `ElectricBlockEntityRenderer` and rendering and interactions will be handled for you. *This option is only suitable if you don't plan to do any extra rendering. See [Custom Implementation](/docs/addons/electricity_system/new_block/custom_implementation.mdx) for explainations on creating a custom block entity renderer.*

<Tabs className="unique-tabs">
  <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
    <div className="code-block">
      <Tabs className="unique-tabs">
        <TabItem value="forge" label={<div><img src={require('/static/img/forge-icon.webp').default}/> Forge</div>} default>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
        <TabItem value="fabric" label={<div><img src={require('/static/img/fabric-icon.webp').default}/> Fabric</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Call this in your client initialization. Replace <YourBlockEntityType> with the instance of the block entity type
          BlockEntityRenderers.register(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          ``` 
        </TabItem>
        <TabItem value="neoforge" label={<div><img src={require('/static/img/neoforge-icon.webp').default}/> NeoForge</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
      </Tabs>
    </div>
  </TabItem>
  <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>}>
    <div className="code-block">
      <Tabs className="unique-tabs">
        <TabItem value="forge" label={<div><img src={require('/static/img/forge-icon.webp').default}/> Forge</div>} default>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
        <TabItem value="fabric" label={<div><img src={require('/static/img/fabric-icon.webp').default}/> Fabric</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Call this in your client initialization. Replace <YourBlockEntityType> with the instance of the block entity type
          BlockEntityRenderers.register(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          ``` 
        </TabItem>
      </Tabs>
    </div>
  </TabItem>
</Tabs>
