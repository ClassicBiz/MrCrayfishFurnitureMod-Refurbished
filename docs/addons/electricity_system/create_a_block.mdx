---
sidebar_position: 2
sidebar_label: Create an Electricity Block
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ForgeIcon from '@site/static/img/forge-icon.webp';
import FabricIcon from '@site/static/img/fabric-icon.webp';
import NeoForgeIcon from '@site/static/img/neoforge-icon.webp';

# Create an Electricity Block

MrCrayfish's Furniture Mod: Refurbished provides many classes and utilities

To create an electricity block, the block must have a block entity and block entity renderer.

## Step 1: Create a Block Entity

### A. Extend a Prebuilt Class <span class="badge badge--primary">Easy</span>

### B. Custom Implementation <span class="badge badge--danger">Advanced</span>

This option is only recommended if you need to implement the electricity system to an existing block entity class and you can't use one of the prebuilt classes, or you want full control of everything. Ensure you follow all the steps carefully to avoid incorrectly implementing the methods and handling syncing.

#### Choose an Interface to Implement

You have the option to **implement** one the following interfaces:
- `IModuleNode` - Use this interface if you want to create a block entity that receives electricity from sources
- `ISourceNode` - Use this interface if you want to create a block entity that supplies electricity to modules

#### Implement the Interface Methods

After appending `implements <interface>` to your block entity class with one of the interfaces from the section above, you will need to write your own implementation of the following methods:

- `getPosition()` - Simply return the `BlockPos` of the block entity. Usually `BlockEntity#worldPosition`.
- `getNodeLevel()` - Simply return the `Level` of the block entity. Usually `BlockEntity#level`.
- `getBlockEntity()` - Simply return the block entity instance. Usually `this`. 
- `isPowered()` - Return a `boolean` representing the powered state. You could use a property from the `BlockState` or a variable inside your custom block entity. You should be able to call this on both the client and server, so ensure the state is available on both sides.
- `setPowered(boolean)` - Updates the powered state. If you are storing the state in a `BlockState` property, just update that. If you use a variable inside your custom block entity, this is a good time to sync any changes to clients and mark the block entity for saving. **Make sure this state is saved to disk!**
- `getConnections()` - Return a `Set` of `Connection` objects. This should just be a simple `HashSet`. Connection management is handle automatically by the mod. You will need to save the connections to disk, the next step will talk about this.
- `isReceivingPower()` - Return a `boolean` representing if the block entity is receiving power from a source.  This should just update a simple `boolean` variable inside your custom block entity. This variable should be update only by `setReceivingPower(boolean)` below. **Do not save this to disk!**
- `setReceivingPower(boolean)` - Marks the block entity as receiving power from an electricity source. This is called before block entities are ticked. This should just update a simple `boolean` variable inside your custom block entity. Syncing to client is optional.

If you are inheriting `ISourceNode` you will also need to implement the following:

- `isOverloaded()` - Return a `boolean` representing if the block entity is overloaded. This should just be a simple `boolean` variable inside your custom block entity. **Make sure this state is saved to disk!**
- `setOverloaded(boolean)` - Updates the overloaded state. This should just be a simple `boolean` variable inside your custom block entity. The variable should be returned in `isOverloaded()`.

Addtionally you will need to override `hashCode()` if you implement either interface. This will simply improve the performance of the search algorithm used in the mod. This can be the hash of `BlockEntity#worldPosition`.

*For more explainations, read the javadoc of each method in your IDE.*

## Step 2: Register the Block Entity Renderer

In order to render the node and its connections, you'll need to register a block entity renderer for your block entity. This is also crucial for enabling interaction with the Wrench. You either have the option to register your block entity renderer with an existing class proivided by the mod, or if you already have a block entity renderer, you just need to call one method.

### A. Bind to Default Block Entity Renderer

MrCrayfish's Furniture Mod: Refurbished comes with a default block entity renderer for electricity blocks. Simply bind your block entity type with `ElectricBlockEntityRenderer` and rendering and interactions will be handled for you. `ElectricBlockEntityRenderer` accepts any block entity type that inherits `BlockEntity` and `IElectricityNode`. *This option is only suitable if you don't plan to do any extra rendering. Refer to option B for more control.*

<Tabs className="unique-tabs">
  <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
    <div className="code-block">
      <Tabs className="unique-tabs">
        <TabItem value="forge" label={<div><img src={require('/static/img/forge-icon.webp').default}/> Forge</div>} default>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
        <TabItem value="fabric" label={<div><img src={require('/static/img/fabric-icon.webp').default}/> Fabric</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Call this in your client initialization. Replace <YourBlockEntityType> with the instance of the block entity type
          BlockEntityRenderers.register(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          ``` 
        </TabItem>
        <TabItem value="neoforge" label={<div><img src={require('/static/img/neoforge-icon.webp').default}/> NeoForge</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
      </Tabs>
    </div>
  </TabItem>
  <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>}>
    <div className="code-block">
      <Tabs className="unique-tabs">
        <TabItem value="forge" label={<div><img src={require('/static/img/forge-icon.webp').default}/> Forge</div>} default>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Make sure to register this event on the mod event bus
          public static void onRegisterRenderers(EntityRenderersEvent.RegisterRenderers event) {
              // Replace <YourBlockEntityType> with the instance of the block entity type
              event.registerBlockEntityRenderer(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          }
          ```  
        </TabItem>
        <TabItem value="fabric" label={<div><img src={require('/static/img/fabric-icon.webp').default}/> Fabric</div>}>
          ```java
          import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

          // Call this in your client initialization. Replace <YourBlockEntityType> with the instance of the block entity type
          BlockEntityRenderers.register(<YourBlockEntityType>, ElectricBlockEntityRenderer::new);
          ``` 
        </TabItem>
      </Tabs>
    </div>
  </TabItem>
</Tabs>

### B. Modifying a Preexisting Block Entity Renderer

If you already have a block entity renderer, you just need to call `drawNodeAndConnections` from `ElectricBlockEntityRenderer` to enabled rendering and interactions.

<Tabs className="unique-tabs">
  <TabItem value="1-20-4" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.4</div>} default>
    ```java
    import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

    @Override
    public void render(T entity, float partialTick, PoseStack stack, MultiBufferSource source, int light, int overlay)
    {
        stack.pushPose();
        // ...
        stack.popPose();

        // Call this last. Make sure you don't perform any transforms, wrap your rendering in push and pop.
        ElectricBlockEntityRenderer.drawNodeAndConnections(entity, stack, source, overlay);
    }
    ```
  </TabItem>
  <TabItem value="1-20-1" label={<div><img src={require('/static/img/minecraft-icon.webp').default}/> 1.20.1</div>}>
    ```java
    import com.mrcrayfish.furniture.refurbished.client.renderer.blockentity.ElectricBlockEntityRenderer;

    @Override
    public void render(T entity, float partialTick, PoseStack stack, MultiBufferSource source, int light, int overlay)
    {
        stack.pushPose();
        // ...
        stack.popPose();

        // Call this last. Make sure you don't perform any transforms, wrap your rendering in push and pop.
        ElectricBlockEntityRenderer.drawNodeAndConnections(entity, stack, source, overlay);
    }
    ```
  </TabItem>
</Tabs>